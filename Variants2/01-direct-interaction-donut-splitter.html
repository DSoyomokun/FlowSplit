<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="view-transition" content="same-origin">
  <!-- Prefetch flow pages for instant navigation -->
  <link rel="prefetch" href="https://p.superdesign.dev/draft/14957248-c82c-4b1c-912f-662210d8c6e7" as="document">
  <link rel="prefetch" href="https://p.superdesign.dev/draft/7e7b49b5-8406-4512-9a10-b1bc6ae83ec8" as="document">
  <link rel="prefetch" href="https://p.superdesign.dev/draft/9edf1601-6e97-448b-a354-07a7173f694d" as="document">
  <link rel="prefetch" href="https://p.superdesign.dev/draft/a0993423-dcff-44a1-844c-b807a4158cc3" as="document">
  <link rel="prefetch" href="https://p.superdesign.dev/draft/5fb4c3e5-74d6-409b-aab3-cc5454a4d41d" as="document">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  <style>
    @import url('https://api.fontshare.com/v2/css?f[]=satoshi@900,700,500,400&display=swap');
    
    body {
      font-family: 'Satoshi', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .custom-shadow {
      box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
    }

    .teal-accent { color: #0EA5A5; }
    .bg-teal-accent { background-color: #0EA5A5; }
    .border-subtle { border: 1px solid rgba(0, 0, 0, 0.04); }

    .chart-container {
      position: relative;
      width: 280px;
      height: 280px;
      touch-action: none;
    }

    .segment {
      cursor: pointer;
      transition: stroke-width 0.2s ease;
    }

    .segment:hover {
      stroke-width: 14;
    }

    .handle {
      cursor: grab;
      transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .handle:active {
      cursor: grabbing;
      transform: scale(1.4);
    }

    .percentage-label {
      font-size: 5px;
      font-weight: 800;
      fill: white;
      pointer-events: none;
      text-shadow: 0px 1px 2px rgba(0,0,0,0.2);
    }
    
    .remainder-label {
      fill: #6B7280;
      text-shadow: none;
    }

    @view-transition { navigation: auto; }
    
    ::view-transition-old(main-content) {
      animation: 0.25s ease-out both fade-out;
    }
    ::view-transition-new(main-content) {
      animation: 0.25s ease-in 0.1s both fade-in;
    }

    @keyframes fade-out { from { opacity: 1; } to { opacity: 0; } }
    @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }

    header { view-transition-name: main-header; }
    .footer-actions { view-transition-name: footer-actions; }
  </style>
</head>
<body>
  <div class="min-h-screen bg-[#F8F8F8] flex flex-col items-center">
    <!-- Header -->
    <header style="view-transition-name: main-header;" class="w-full max-w-[375px] h-[64px] px-6 flex items-center justify-between bg-white border-b border-gray-100 sticky top-0 z-50">
      <div class="w-8"></div>
      <h1 class="text-[18px] font-bold tracking-tight text-gray-900">FlowSplit</h1>
      <button id="nav-menu-btn" class="w-8 h-8 flex items-center justify-end text-gray-600">
        <iconify-icon icon="lucide:menu" class="text-2xl"></iconify-icon>
      </button>
    </header>

    <main style="view-transition-name: main-content;" class="w-full max-w-[375px] p-5 space-y-6 pb-40">
      
      <!-- Interactive Chart Hero -->
      <section class="bg-white rounded-[32px] p-8 border-subtle custom-shadow overflow-hidden flex flex-col items-center">
        <div class="chart-container flex items-center justify-center">
          <svg id="split-svg" viewBox="0 0 100 100" class="w-full h-full">
            <!-- Circles are rendered via JS -->
            <g id="segments-group"></g>
            <g id="labels-group"></g>
            <g id="handles-group"></g>
          </svg>
          <!-- Center Content -->
          <div class="absolute inset-0 flex flex-col items-center justify-center text-center pointer-events-none">
            <p class="text-[11px] uppercase tracking-[0.15em] text-gray-400 font-bold mb-1">Deposit</p>
            <h2 id="display-total" class="text-3xl font-black text-gray-900">$1,200</h2>
            <p class="text-[10px] text-gray-400 font-medium mt-1">Drag to adjust</p>
          </div>
        </div>

        <!-- Bucket Summary Cards -->
        <div class="mt-10 w-full grid grid-cols-1 gap-3">
          <!-- Tithe -->
          <div class="bg-white p-4 rounded-2xl border-subtle flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 rounded-full bg-[#0EA5A5]"></div>
              <span class="text-sm font-bold text-gray-700">Tithe</span>
            </div>
            <div class="text-right">
              <span id="card-tithe-pct" class="text-sm font-black text-gray-900">10%</span>
              <span id="card-tithe-usd" class="text-xs text-gray-400 block">$120.00</span>
            </div>
          </div>

          <!-- Savings -->
          <div class="bg-white p-4 rounded-2xl border-subtle flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 rounded-full bg-[#3B82F6]"></div>
              <span class="text-sm font-bold text-gray-700">Savings</span>
            </div>
            <div class="text-right">
              <span id="card-savings-pct" class="text-sm font-black text-gray-900">15%</span>
              <span id="card-savings-usd" class="text-xs text-gray-400 block">$180.00</span>
            </div>
          </div>

          <!-- Investing -->
          <div class="bg-white p-4 rounded-2xl border-subtle flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 rounded-full bg-[#10B981]"></div>
              <span class="text-sm font-bold text-gray-700">Investing</span>
            </div>
            <div class="text-right">
              <span id="card-investing-pct" class="text-sm font-black text-gray-900">10%</span>
              <span id="card-investing-usd" class="text-xs text-gray-400 block">$120.00</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Remainder Section -->
      <section class="bg-white rounded-2xl p-4 border-subtle custom-shadow flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-gray-50 rounded-xl flex items-center justify-center">
            <iconify-icon icon="lucide:wallet" class="text-gray-400 text-xl"></iconify-icon>
          </div>
          <div>
            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-tight">Checking Account</p>
            <span class="text-sm font-bold text-gray-800">Remainder kept</span>
          </div>
        </div>
        <div class="text-right">
          <span id="card-remainder-pct" class="text-[10px] font-bold text-gray-400 block">65%</span>
          <span id="card-remainder-usd" class="text-base font-black text-teal-accent">$780.00</span>
        </div>
      </section>
    </main>

    <!-- Fixed Bottom Actions -->
    <div class="fixed bottom-0 footer-actions w-full max-w-[375px] bg-white/95 backdrop-blur-xl border-t border-gray-100 px-6 pt-5 pb-2 flex flex-col gap-3 shadow-[0_-10px_30px_-15px_rgba(0,0,0,0.1)] z-[100]">
      <a id="nav-confirmation-link" href="https://p.superdesign.dev/draft/a0993423-dcff-44a1-844c-b807a4158cc3" class="w-full bg-teal-accent hover:bg-[#0C8F8F] text-white font-bold py-4 rounded-2xl transition-all active:scale-[0.98] custom-shadow text-center block">
        Confirm $1,200 Split
      </a>
      <a id="nav-deposit-setup-link" href="https://p.superdesign.dev/draft/14957248-c82c-4b1c-912f-662210d8c6e7" class="w-full bg-transparent text-gray-400 font-medium py-2 rounded-xl text-sm text-center block mb-2">
        Keep everything in checking
      </a>
      <nav class="flex justify-around items-center pt-2 border-t border-gray-50">
        <a id="nav-split-link" href="https://p.superdesign.dev/draft/7e7b49b5-8406-4512-9a10-b1bc6ae83ec8" class="flex flex-col items-center gap-1 text-teal-accent">
          <iconify-icon icon="lucide:pie-chart" class="text-xl"></iconify-icon>
          <span class="text-[10px] font-bold">Split</span>
        </a>
        <a id="nav-buckets-link" href="https://p.superdesign.dev/draft/9edf1601-6e97-448b-a354-07a7173f694d" class="flex flex-col items-center gap-1 text-gray-400 hover:text-gray-600 transition-colors">
          <iconify-icon icon="lucide:layers" class="text-xl"></iconify-icon>
          <span class="text-[10px] font-bold">Buckets</span>
        </a>
        <a id="nav-history-link" href="https://p.superdesign.dev/draft/5fb4c3e5-74d6-409b-aab3-cc5454a4d41d" class="flex flex-col items-center gap-1 text-gray-400 hover:text-gray-600 transition-colors">
          <iconify-icon icon="lucide:history" class="text-xl"></iconify-icon>
          <span class="text-[10px] font-bold">History</span>
        </a>
      </nav>
    </div>
  </div>

  <script>
    const TOTAL_USD = 1200;
    const RADIUS = 40;
    const CENTER = 50;
    const CIRCUMFERENCE = 2 * Math.PI * RADIUS;

    // State: Split points as percentages (0 to 100)
    let splitPoints = [10, 25, 35]; // End of Tithe, End of Savings, End of Investing
    const colors = ['#0EA5A5', '#3B82F6', '#10B981', '#E5E7EB'];
    const bucketNames = ['Tithe', 'Savings', 'Investing', 'Remainder'];

    const svg = document.getElementById('split-svg');
    const segmentsGroup = document.getElementById('segments-group');
    const labelsGroup = document.getElementById('labels-group');
    const handlesGroup = document.getElementById('handles-group');

    let activeHandleIndex = null;

    function updateUI() {
      segmentsGroup.innerHTML = '';
      labelsGroup.innerHTML = '';
      handlesGroup.innerHTML = '';

      const allPoints = [0, ...splitPoints, 100];
      
      allPoints.forEach((point, i) => {
        if (i === allPoints.length - 1) return;
        
        const start = allPoints[i];
        const end = allPoints[i+1];
        const size = end - start;

        // Draw Segment
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", CENTER);
        circle.setAttribute("cy", CENTER);
        circle.setAttribute("r", RADIUS);
        circle.setAttribute("fill", "transparent");
        circle.setAttribute("stroke", colors[i]);
        circle.setAttribute("stroke-width", "12");
        circle.setAttribute("stroke-dasharray", `${(size/100) * CIRCUMFERENCE} ${CIRCUMFERENCE}`);
        // Rotate to start point (SVG starts at 3 o'clock, we want 12 o'clock hence -90deg)
        circle.setAttribute("transform", `rotate(${(start/100)*360 - 90} ${CENTER} ${CENTER})`);
        circle.classList.add('segment');
        segmentsGroup.appendChild(circle);

        // Draw Label at midpoint
        if (size > 5) {
          const midPct = start + (size / 2);
          const angle = (midPct / 100) * 360 - 90;
          const rad = (angle * Math.PI) / 180;
          const x = CENTER + RADIUS * Math.cos(rad);
          const y = CENTER + RADIUS * Math.sin(rad);

          const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
          text.setAttribute("x", x);
          text.setAttribute("y", y + 1.5);
          text.setAttribute("text-anchor", "middle");
          text.classList.add('percentage-label');
          if (i === 3) text.classList.add('remainder-label');
          text.textContent = `${Math.round(size)}%`;
          labelsGroup.appendChild(text);
        }

        // Update Card Details
        const key = bucketNames[i].toLowerCase();
        const pctEl = document.getElementById(`card-${key}-pct`);
        const usdEl = document.getElementById(`card-${key}-usd`);
        if (pctEl) pctEl.textContent = `${Math.round(size)}%`;
        if (usdEl) usdEl.textContent = `$${(TOTAL_USD * (size / 100)).toFixed(2)}`;
      });

      // Draw Handles
      splitPoints.forEach((point, i) => {
        const angle = (point / 100) * 360 - 90;
        const rad = (angle * Math.PI) / 180;
        const x = CENTER + RADIUS * Math.cos(rad);
        const y = CENTER + RADIUS * Math.sin(rad);

        const handle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        handle.setAttribute("cx", x);
        handle.setAttribute("cy", y);
        handle.setAttribute("r", "4.5");
        handle.setAttribute("fill", "white");
        handle.setAttribute("stroke", "#CBD5E1");
        handle.setAttribute("stroke-width", "1");
        handle.classList.add('handle', 'custom-shadow');
        handle.addEventListener('mousedown', (e) => startDrag(e, i));
        handle.addEventListener('touchstart', (e) => startDrag(e, i));
        handlesGroup.appendChild(handle);
      });
    }

    function startDrag(e, index) {
      activeHandleIndex = index;
      e.preventDefault();
    }

    function onMove(e) {
      if (activeHandleIndex === null) return;

      const rect = svg.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      
      const x = clientX - rect.left - rect.width / 2;
      const y = clientY - rect.top - rect.height / 2;

      let angle = Math.atan2(y, x) * (180 / Math.PI) + 90;
      if (angle < 0) angle += 360;
      
      const newPct = (angle / 360) * 100;

      // Constraints: handle[i] must be between its neighbors
      const min = activeHandleIndex === 0 ? 0 : splitPoints[activeHandleIndex - 1] + 1;
      const max = activeHandleIndex === splitPoints.length - 1 ? 100 : splitPoints[activeHandleIndex + 1] - 1;

      splitPoints[activeHandleIndex] = Math.max(min, Math.min(max, newPct));
      updateUI();
    }

    function onEnd() {
      activeHandleIndex = null;
    }

    window.addEventListener('mousemove', onMove);
    window.addEventListener('touchmove', onMove, { passive: false });
    window.addEventListener('mouseup', onEnd);
    window.addEventListener('touchend', onEnd);

    // Initial Render
    updateUI();
  </script>
</body>
</html>