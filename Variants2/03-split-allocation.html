<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlowSplit â€” Split Allocation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  <meta name="view-transition" content="same-origin">
  <link rel="prefetch" href="https://p.superdesign.dev/draft/b92e5b63-41fc-4fe3-9b06-6ad7905f3d06" as="document">
  <link rel="prefetch" href="https://p.superdesign.dev/draft/14957248-c82c-4b1c-912f-662210d8c6e7" as="document">
  <link rel="prefetch" href="https://p.superdesign.dev/draft/9edf1601-6e97-448b-a354-07a7173f694d" as="document">
  <link rel="prefetch" href="https://p.superdesign.dev/draft/a0993423-dcff-44a1-844c-b807a4158cc3" as="document">
  <link rel="prefetch" href="https://p.superdesign.dev/draft/5fb4c3e5-74d6-409b-aab3-cc5454a4d41d" as="document">
  <style>
    @import url('https://api.fontshare.com/v2/css?f[]=satoshi@900,700,500,400&display=swap');
    
    html { background-color: #F8F8F8; }
    @view-transition { navigation: auto; }
    ::view-transition { background-color: #F8F8F8; }

    /* Persistent Nav */
    ::view-transition-old(main-nav), ::view-transition-new(main-nav) {
      animation: none;
      mix-blend-mode: normal;
    }

    /* Dynamic content area - animate */
    ::view-transition-old(main-content) {
      animation: 0.2s ease-out both fade-out;
    }
    ::view-transition-new(main-content) {
      animation: 0.25s ease-in 0.05s both fade-in;
    }

    @keyframes fade-out { from { opacity: 1; } to { opacity: 0; } }
    @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }

    body {
      font-family: 'Satoshi', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .custom-shadow {
      box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.04);
    }

    .chart-container {
      position: relative;
      width: 260px;
      height: 260px;
      touch-action: none;
    }

    .segment { cursor: pointer; transition: stroke-width 0.2s ease; }
    .segment:hover { stroke-width: 14; }
    .handle {
      cursor: grab;
      transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .handle:active { cursor: grabbing; transform: scale(1.4); }
    
    .percentage-label {
      font-size: 5px;
      font-weight: 800;
      fill: white;
      pointer-events: none;
      text-shadow: 0px 1px 2px rgba(0,0,0,0.1);
    }
    
    .remainder-label {
      fill: #6B7280;
      text-shadow: none;
    }
  </style>
</head>
<body>
  <div class="w-full min-h-screen flex flex-col bg-[#F8F8F8]">
    
    <!-- Header: Persistent -->
    <header style="view-transition-name: main-nav" class="pt-14 px-6 pb-4 flex items-center justify-between bg-white border-b border-gray-100 z-50">
      <div class="w-8">
        <a href="https://p.superdesign.dev/draft/14957248-c82c-4b1c-912f-662210d8c6e7" id="nav-back-link" class="text-gray-400 hover:text-gray-900 transition-colors">
          <iconify-icon icon="lucide:chevron-left" class="text-2xl"></iconify-icon>
        </a>
      </div>
      <h1 class="text-[17px] font-black tracking-tight text-gray-900">FlowSplit</h1>
      <button id="nav-menu-btn" class="w-8 h-8 flex items-center justify-end text-gray-400">
        <iconify-icon icon="lucide:settings-2" class="text-2xl"></iconify-icon>
      </button>
    </header>

    <main style="view-transition-name: main-content" class="flex-1 overflow-auto p-5 space-y-6">
      
      <!-- Interactive Chart Card -->
      <section class="bg-white rounded-[32px] p-8 border border-gray-100 custom-shadow flex flex-col items-center">
        <div class="chart-container flex items-center justify-center">
          <svg id="split-svg" viewBox="0 0 100 100" class="w-full h-full">
            <g id="segments-group"></g>
            <g id="labels-group"></g>
            <g id="handles-group"></g>
          </svg>
          <!-- Center Info -->
          <div class="absolute inset-0 flex flex-col items-center justify-center text-center pointer-events-none">
            <p class="text-[10px] uppercase tracking-[0.2em] text-gray-400 font-bold mb-0.5">Split Plan</p>
            <h2 id="display-total" class="text-3xl font-black text-gray-900">$1,200</h2>
            <p class="text-[10px] text-gray-400 font-medium">Drag to adjust</p>
          </div>
        </div>

        <!-- Allocation List -->
        <div class="mt-10 w-full space-y-3">
          <!-- Tithe -->
          <div class="bg-gray-50/50 p-4 rounded-2xl flex items-center justify-between border border-transparent hover:border-gray-100 transition-colors">
            <div class="flex items-center gap-3">
              <div class="w-2.5 h-2.5 rounded-full bg-[#0EA5A5]"></div>
              <span class="text-sm font-bold text-gray-700">Tithe</span>
            </div>
            <div class="text-right">
              <span id="card-tithe-pct" class="text-sm font-black text-gray-900">10%</span>
              <span id="card-tithe-usd" class="text-[11px] text-gray-400 block font-medium">$120.00</span>
            </div>
          </div>

          <!-- Savings -->
          <div class="bg-gray-50/50 p-4 rounded-2xl flex items-center justify-between border border-transparent hover:border-gray-100 transition-colors">
            <div class="flex items-center gap-3">
              <div class="w-2.5 h-2.5 rounded-full bg-[#3B82F6]"></div>
              <span class="text-sm font-bold text-gray-700">Savings</span>
            </div>
            <div class="text-right">
              <span id="card-savings-pct" class="text-sm font-black text-gray-900">15%</span>
              <span id="card-savings-usd" class="text-[11px] text-gray-400 block font-medium">$180.00</span>
            </div>
          </div>

          <!-- Investing -->
          <div class="bg-gray-50/50 p-4 rounded-2xl flex items-center justify-between border border-transparent hover:border-gray-100 transition-colors">
            <div class="flex items-center gap-3">
              <div class="w-2.5 h-2.5 rounded-full bg-[#10B981]"></div>
              <span class="text-sm font-bold text-gray-700">Investing</span>
            </div>
            <div class="text-right">
              <span id="card-investing-pct" class="text-sm font-black text-gray-900">10%</span>
              <span id="card-investing-usd" class="text-[11px] text-gray-400 block font-medium">$120.00</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Remainder Bucket -->
      <section class="bg-white rounded-2xl p-5 border border-gray-100 custom-shadow flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="w-10 h-10 bg-gray-50 rounded-xl flex items-center justify-center text-gray-400">
            <iconify-icon icon="lucide:landmark" class="text-xl"></iconify-icon>
          </div>
          <div>
            <p class="text-[10px] font-black text-gray-400 uppercase tracking-wider mb-0.5">Main Wallet</p>
            <span class="text-sm font-bold text-gray-800">Checking Remainder</span>
          </div>
        </div>
        <div class="text-right">
          <span id="card-remainder-pct" class="text-[10px] font-bold text-gray-400 block mb-0.5">65%</span>
          <span id="card-remainder-usd" class="text-lg font-black text-[#0EA5A5]">$780.00</span>
        </div>
      </section>

      <!-- Floating Spacer for fixed bottom -->
      <div class="h-24"></div>
    </main>

    <!-- Actions: Sticky Bottom -->
    <footer class="fixed bottom-0 w-full bg-white/80 backdrop-blur-xl border-t border-gray-100 px-6 pt-6 pb-[34px] flex flex-col gap-3 z-[100] shadow-[0_-8px_32px_rgba(0,0,0,0.03)]">
      <a href="https://p.superdesign.dev/draft/a0993423-dcff-44a1-844c-b807a4158cc3" id="confirm-split-btn" class="w-full bg-[#0EA5A5] hover:bg-[#0C8F8F] text-white font-bold h-14 rounded-2xl flex items-center justify-center transition-all active:scale-[0.98] shadow-lg shadow-[#0EA5A5]/20">
        Confirm $1,200 Split
      </a>
      <a href="https://p.superdesign.dev/draft/14957248-c82c-4b1c-912f-662210d8c6e7" id="cancel-btn" class="w-full text-center text-gray-400 font-bold text-xs py-1 tracking-tight">
        KEEP EVERYTHING IN CHECKING
      </a>
    </footer>

  </div>

  <script>
    const TOTAL_USD = 1200;
    const RADIUS = 40;
    const CENTER = 50;
    const CIRCUMFERENCE = 2 * Math.PI * RADIUS;

    // Initial state: Start/End percentages for buckets
    // Bucket 1 (Tithe): 0 to 10
    // Bucket 2 (Savings): 10 to 25
    // Bucket 3 (Investing): 25 to 35
    // Remainder: 35 to 100
    let splitPoints = [10, 25, 35]; 
    const colors = ['#0EA5A5', '#3B82F6', '#10B981', '#E5E7EB'];
    const bucketNames = ['Tithe', 'Savings', 'Investing', 'Remainder'];

    const svg = document.getElementById('split-svg');
    const segmentsGroup = document.getElementById('segments-group');
    const labelsGroup = document.getElementById('labels-group');
    const handlesGroup = document.getElementById('handles-group');

    let activeHandleIndex = null;

    function updateUI() {
      segmentsGroup.innerHTML = '';
      labelsGroup.innerHTML = '';
      handlesGroup.innerHTML = '';

      const allPoints = [0, ...splitPoints, 100];
      
      allPoints.forEach((point, i) => {
        if (i === allPoints.length - 1) return;
        
        const start = allPoints[i];
        const end = allPoints[i+1];
        const size = end - start;

        // Draw Arc Segment
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", CENTER);
        circle.setAttribute("cy", CENTER);
        circle.setAttribute("r", RADIUS);
        circle.setAttribute("fill", "transparent");
        circle.setAttribute("stroke", colors[i]);
        circle.setAttribute("stroke-width", "12");
        circle.setAttribute("stroke-dasharray", `${(size/100) * CIRCUMFERENCE} ${CIRCUMFERENCE}`);
        circle.setAttribute("transform", `rotate(${(start/100)*360 - 90} ${CENTER} ${CENTER})`);
        circle.classList.add('segment');
        segmentsGroup.appendChild(circle);

        // Percentage labels at midpoint
        if (size > 4) {
          const midPct = start + (size / 2);
          const angle = (midPct / 100) * 360 - 90;
          const rad = (angle * Math.PI) / 180;
          const x = CENTER + RADIUS * Math.cos(rad);
          const y = CENTER + RADIUS * Math.sin(rad);

          const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
          text.setAttribute("x", x);
          text.setAttribute("y", y + 1.5);
          text.setAttribute("text-anchor", "middle");
          text.classList.add('percentage-label');
          if (i === 3) text.classList.add('remainder-label');
          text.textContent = `${Math.round(size)}%`;
          labelsGroup.appendChild(text);
        }

        // Sync text labels in the list
        const key = bucketNames[i].toLowerCase();
        const pctEl = document.getElementById(`card-${key}-pct`);
        const usdEl = document.getElementById(`card-${key}-usd`);
        if (pctEl) pctEl.textContent = `${Math.round(size)}%`;
        if (usdEl) usdEl.textContent = `$${(TOTAL_USD * (size / 100)).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
      });

      // Drag handles at each split point
      splitPoints.forEach((point, i) => {
        const angle = (point / 100) * 360 - 90;
        const rad = (angle * Math.PI) / 180;
        const x = CENTER + RADIUS * Math.cos(rad);
        const y = CENTER + RADIUS * Math.sin(rad);

        const handle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        handle.setAttribute("cx", x);
        handle.setAttribute("cy", y);
        handle.setAttribute("r", "4.5");
        handle.setAttribute("fill", "white");
        handle.setAttribute("stroke", "#CBD5E1");
        handle.setAttribute("stroke-width", "1.5");
        handle.classList.add('handle', 'shadow-sm');
        
        const startHandler = (e) => {
          activeHandleIndex = i;
          e.preventDefault();
        };

        handle.addEventListener('mousedown', startHandler);
        handle.addEventListener('touchstart', startHandler);
        handlesGroup.appendChild(handle);
      });
    }

    function handleMove(e) {
      if (activeHandleIndex === null) return;

      const rect = svg.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      
      const x = clientX - (rect.left + rect.width / 2);
      const y = clientY - (rect.top + rect.height / 2);

      let angle = Math.atan2(y, x) * (180 / Math.PI) + 90;
      if (angle < 0) angle += 360;
      
      const newPct = (angle / 360) * 100;

      // Logic to prevent overlapping and keep order
      const min = activeHandleIndex === 0 ? 1 : splitPoints[activeHandleIndex - 1] + 1;
      const max = activeHandleIndex === splitPoints.length - 1 ? 99 : splitPoints[activeHandleIndex + 1] - 1;

      splitPoints[activeHandleIndex] = Math.max(min, Math.min(max, newPct));
      updateUI();
    }

    function endMove() {
      activeHandleIndex = null;
    }

    window.addEventListener('mousemove', handleMove);
    window.addEventListener('touchmove', handleMove, { passive: false });
    window.addEventListener('mouseup', endMove);
    window.addEventListener('touchend', endMove);

    // Render initial chart state
    updateUI();
  </script>
</body>
</html>